metric_keys:
  - index_cache_hit_rate
dashboard:
  title: Heroku Postgres
  description: Postgres metrics provided by the Heroku Log Drain. Shows database size, connections and index hit rates.
  graphs:
    - title: Database Size
      description: The number of bytes contained in the database. This includes all table and index data on disk, including database bloat.
      line_label: '%source%'
      format: size
      format_input: byte
      draw_null_as_zero: false
      metrics:
        - name: db_size
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Tables
      description: The number of tables in the database.
      line_label: '%source%'
      format: number
      draw_null_as_zero: false
      metrics:
        - name: tables
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Index Cache Hit Rate
      description: Ratio of index lookups served from shared buffer cache, rounded to five decimal points. Heroku recommends a value of 0.98 or greater if possible. If your index hit rate is consistently less than 0.98, you should investigate your Expensive Queries or you may need to upgrade your database plan for more RAM.
      line_label: '%source%'
      format: number
      draw_null_as_zero: false
      metrics:
        - name: index_cache_hit_rate
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Table Cache Hit Rate
      description: Ratio of table lookups served from shared buffer cache, rounded to five decimal points. Heroku recommends a value of 0.98 or greater if possible. If your table hit rate is consistently less than 0.98, you may need to upgrade your database plan for more RAM.
      line_label: '%source%'
      format: number
      draw_null_as_zero: false
      metrics:
        - name: table_cache_hit_rate
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Active Connections
      description: The number of connections established on the database.
      line_label: '%source%'
      format: number
      draw_null_as_zero: false
      metrics:
        - name: active_connections
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Waiting Connections
      description: Number of connections waiting on a lock to be acquired. If many connections are waiting, this can be a sign of mishandled database concurrency.
      line_label: '%source%'
      format: number
      draw_null_as_zero: false
      metrics:
        - name: waiting_connections
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
    - title: Memory
      description: Approximate amount of memory used by your databaseâ€™s Postgres processes in kB. This includes shared buffer cache as well as memory for each connection.
      line_label: '%source%'
      format: size
      format_input: kilobyte
      draw_null_as_zero: false
      metrics:
        - name: memory
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
            state: postgres

    - title: Database server Load average
      description: "Average load on the system over a period of 1 minute"
      line_label: "%source%"
      format: number
      draw_null_as_zero: false
      metrics:
        - name: load_avg
          fields:
            - GAUGE
          tags:
            source: '*'
            addon: '*'

    - title: Database server I/O
      description: "Number of read/write operations in I/O sizes of 16KB blocks"
      line_label: "%source% - %name%"
      format: number
      draw_null_as_zero: false
      metrics:
        - name: read_iops
          fields:
            - GAUGE
          tags:
            source: '*'
            addon: '*'
        - name: write_iops
          fields:
            - GAUGE
          tags:
            source: '*'
            addon: '*'

    - title: Database server memory
      description: "Server memory in use/free/cached"
      line_label: "%source% - %state%"
      format: size
      draw_null_as_zero: false
      metrics:
        - name: memory
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
            state: total
        - name: memory
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
            state: free
        - name: memory
          fields:
            - GAUGE
          tags:
            addon: "*"
            source: "*"
            state: cached
